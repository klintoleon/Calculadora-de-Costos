<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Costos - Repostería</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-50 to-orange-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">🧁 Calculadora de Costos</h1>
            <p class="text-gray-600">Gestiona ingredientes y calcula el costo de tus productos de repostería</p>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
            <!-- Panel de Ingredientes -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                    🥄 Ingredientes
                </h2>
                
                <!-- Formulario para agregar ingredientes -->
                <div class="bg-gray-50 rounded-xl p-4 mb-6">
                    <h3 class="font-medium text-gray-700 mb-3">Agregar Nuevo Ingrediente</h3>
                    <div class="space-y-3">
                        <input type="text" id="ingredientName" placeholder="Nombre del ingrediente" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                        
                        <div class="bg-white rounded-lg p-3 border border-gray-200">
                            <label class="text-sm font-medium text-gray-600 mb-2 block">Información del Producto Comprado</label>
                            <div class="grid grid-cols-3 gap-2">
                                <input type="number" id="productQuantity" placeholder="Cantidad" step="0.01"
                                       class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm">
                                <select id="productUnit" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm">
                                    <optgroup label="Peso">
                                        <option value="kg">kg</option>
                                        <option value="lb">lb</option>
                                        <option value="g">g</option>
                                        <option value="oz">oz</option>
                                    </optgroup>
                                    <optgroup label="Volumen">
                                        <option value="l">litros</option>
                                        <option value="ml">ml</option>
                                        <option value="gal">galones</option>
                                        <option value="qt">cuartos</option>
                                        <option value="pt">pintas</option>
                                        <option value="fl-oz">fl oz</option>
                                    </optgroup>
                                    <optgroup label="Otros">
                                        <option value="unidad">unidades</option>
                                        <option value="docena">docenas</option>
                                    </optgroup>
                                </select>
                                <input type="number" id="totalPrice" placeholder="Precio total" step="0.01"
                                       class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent text-sm">
                            </div>
                            <div class="text-xs text-gray-500 mt-1">
                                Ej: 230 gramos por $2.26 total
                            </div>
                        </div>
                        
                        <button onclick="addIngredient()" class="w-full bg-pink-500 hover:bg-pink-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                            Agregar Ingrediente
                        </button>
                    </div>
                </div>

                <!-- Lista de ingredientes -->
                <div id="ingredientsList" class="space-y-2">
                    <!-- Los ingredientes se mostrarán aquí -->
                </div>
            </div>

            <!-- Panel de Productos -->
            <div class="bg-white rounded-2xl shadow-lg p-6">
                <h2 class="text-2xl font-semibold text-gray-800 mb-6 flex items-center">
                    🍰 Productos
                </h2>

                <!-- Formulario para crear producto -->
                <div class="bg-gray-50 rounded-xl p-4 mb-6">
                    <h3 class="font-medium text-gray-700 mb-3">Crear Nuevo Producto</h3>
                    <input type="text" id="productName" placeholder="Nombre del producto" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent mb-3">
                    
                    <div id="recipeIngredients" class="space-y-2 mb-3">
                        <!-- Ingredientes de la receta se mostrarán aquí -->
                    </div>
                    
                    <button onclick="addRecipeIngredient()" class="w-full bg-orange-400 hover:bg-orange-500 text-white font-medium py-2 px-4 rounded-lg transition-colors mb-2">
                        + Agregar Ingrediente a la Receta
                    </button>
                    
                    <button onclick="createProduct()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        Crear Producto
                    </button>
                </div>

                <!-- Lista de productos -->
                <div id="productsList" class="space-y-4">
                    <!-- Los productos se mostrarán aquí -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let ingredients = [];
        let products = [];
        let recipeIngredients = [];

        function addIngredient() {
            const name = document.getElementById('ingredientName').value.trim();
            const productQuantity = parseFloat(document.getElementById('productQuantity').value);
            const productUnit = document.getElementById('productUnit').value;
            const totalPrice = parseFloat(document.getElementById('totalPrice').value);

            if (!name || !productQuantity || !totalPrice || productQuantity <= 0 || totalPrice <= 0) {
                alert('Por favor completa todos los campos correctamente');
                return;
            }

            // Calcular precio por unidad base
            const pricePerUnit = totalPrice / productQuantity;

            const ingredient = {
                id: Date.now(),
                name: name,
                productQuantity: productQuantity,
                productUnit: productUnit,
                totalPrice: totalPrice,
                pricePerUnit: pricePerUnit,
                unit: productUnit // Para compatibilidad con el código existente
            };

            ingredients.push(ingredient);
            updateIngredientsDisplay();
            clearIngredientForm();
        }

        function clearIngredientForm() {
            document.getElementById('ingredientName').value = '';
            document.getElementById('productQuantity').value = '';
            document.getElementById('productUnit').value = 'g';
            document.getElementById('totalPrice').value = '';
        }

        function updateIngredientsDisplay() {
            const container = document.getElementById('ingredientsList');
            container.innerHTML = '';

            ingredients.forEach(ingredient => {
                const div = document.createElement('div');
                div.className = 'bg-pink-50 p-3 rounded-lg';
                div.innerHTML = `
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <span class="font-medium text-gray-800 block">${ingredient.name}</span>
                            <div class="text-sm text-gray-600 mt-1">
                                <div>${ingredient.productQuantity} ${ingredient.productUnit} por $${ingredient.totalPrice.toFixed(2)}</div>
                                <div class="text-xs text-pink-600 font-medium">$${ingredient.pricePerUnit.toFixed(4)} por ${ingredient.productUnit}</div>
                            </div>
                        </div>
                        <button onclick="removeIngredient(${ingredient.id})" class="text-red-500 hover:text-red-700 font-bold ml-2">×</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function removeIngredient(id) {
            ingredients = ingredients.filter(ing => ing.id !== id);
            updateIngredientsDisplay();
        }

        function addRecipeIngredient() {
            if (ingredients.length === 0) {
                alert('Primero agrega algunos ingredientes');
                return;
            }

            const container = document.getElementById('recipeIngredients');
            const div = document.createElement('div');
            div.className = 'flex gap-2 items-center bg-orange-50 p-2 rounded-lg';
            
            const selectOptions = ingredients.map(ing => 
                `<option value="${ing.id}">${ing.name} ($${ing.pricePerUnit.toFixed(4)} por ${ing.unit})</option>`
            ).join('');

            div.innerHTML = `
                <select class="flex-1 px-3 py-1 border border-gray-300 rounded text-sm">
                    ${selectOptions}
                </select>
                <input type="number" placeholder="Cantidad" step="0.01" class="w-16 px-2 py-1 border border-gray-300 rounded text-sm">
                <select class="w-24 px-2 py-1 border border-gray-300 rounded text-sm">
                    <optgroup label="Medidas de Cocina">
                        <option value="taza">taza</option>
                        <option value="1/2-taza">1/2 taza</option>
                        <option value="1/3-taza">1/3 taza</option>
                        <option value="1/4-taza">1/4 taza</option>
                        <option value="cda">cucharada</option>
                        <option value="cdta">cucharadita</option>
                        <option value="pizca">pizca</option>
                    </optgroup>
                    <optgroup label="Peso">
                        <option value="kg">kg</option>
                        <option value="lb">lb</option>
                        <option value="g">g</option>
                        <option value="oz">oz</option>
                    </optgroup>
                    <optgroup label="Volumen">
                        <option value="l">litro</option>
                        <option value="ml">ml</option>
                        <option value="gal">galón</option>
                        <option value="qt">cuarto</option>
                        <option value="pt">pinta</option>
                        <option value="fl-oz">fl oz</option>
                    </optgroup>
                    <optgroup label="Otros">
                        <option value="unidad">unidad</option>
                        <option value="docena">docena</option>
                    </optgroup>
                </select>
                <button onclick="this.parentElement.remove()" class="text-red-500 hover:text-red-700 font-bold">×</button>
            `;
            
            container.appendChild(div);
        }

        function createProduct() {
            const productName = document.getElementById('productName').value.trim();
            const recipeContainer = document.getElementById('recipeIngredients');
            const recipeItems = recipeContainer.children;

            if (!productName) {
                alert('Ingresa el nombre del producto');
                return;
            }

            if (recipeItems.length === 0) {
                alert('Agrega al menos un ingrediente a la receta');
                return;
            }

            let totalCost = 0;
            const recipe = [];

            for (let item of recipeItems) {
                const selects = item.querySelectorAll('select');
                const quantityInput = item.querySelector('input');
                const ingredientId = parseInt(selects[0].value);
                const quantity = parseFloat(quantityInput.value);
                const recipeUnit = selects[1].value;

                if (!quantity || quantity <= 0) {
                    alert('Ingresa cantidades válidas para todos los ingredientes');
                    return;
                }

                const ingredient = ingredients.find(ing => ing.id === ingredientId);
                const cost = calculateIngredientCost(ingredient, quantity, recipeUnit);
                
                recipe.push({
                    ingredient: ingredient,
                    quantity: quantity,
                    unit: recipeUnit,
                    cost: cost
                });

                totalCost += cost;
            }

            const product = {
                id: Date.now(),
                name: productName,
                recipe: recipe,
                totalCost: totalCost
            };

            products.push(product);
            updateProductsDisplay();
            clearProductForm();
        }

        // Conversiones a gramos para ingredientes sólidos
        const solidConversions = {
            // Medidas de cocina comunes
            'taza': 120,        // 1 taza de harina ≈ 120g
            '1/2-taza': 60,
            '1/3-taza': 40,
            '1/4-taza': 30,
            'cda': 15,          // 1 cucharada ≈ 15g
            'cdta': 5,          // 1 cucharadita ≈ 5g
            'pizca': 0.5,
            // Unidades de peso
            'kg': 1000,
            'lb': 453.592,
            'g': 1,
            'oz': 28.3495,
            'unidad': 1,
            'docena': 12
        };

        // Conversiones a mililitros para ingredientes líquidos
        const liquidConversions = {
            // Medidas de cocina comunes
            'taza': 240,        // 1 taza ≈ 240ml
            '1/2-taza': 120,
            '1/3-taza': 80,
            '1/4-taza': 60,
            'cda': 15,          // 1 cucharada ≈ 15ml
            'cdta': 5,          // 1 cucharadita ≈ 5ml
            'pizca': 1,
            // Unidades de volumen
            'l': 1000,
            'ml': 1,
            'gal': 3785.41,
            'qt': 946.353,
            'pt': 473.176,
            'fl-oz': 29.5735,
            'unidad': 1,
            'docena': 12
        };

        function calculateIngredientCost(ingredient, recipeQuantity, recipeUnit) {
            const ingredientUnit = ingredient.unit;
            const ingredientPricePerUnit = ingredient.pricePerUnit;
            
            // Convertir todo a gramos como unidad base para ingredientes sólidos
            // y mililitros para líquidos
            
            // Determinar si el ingrediente comprado es líquido
            const isIngredientLiquid = ['l', 'ml', 'gal', 'qt', 'pt', 'fl-oz'].includes(ingredientUnit);
            
            let ingredientInGrams, recipeInGrams;
            
            if (isIngredientLiquid) {
                // Para ingredientes líquidos, convertir a ml
                const ingredientInMl = liquidConversions[ingredientUnit] || 1;
                const recipeInMl = (liquidConversions[recipeUnit] || solidConversions[recipeUnit] || 1) * recipeQuantity;
                
                const costPerMl = ingredientPricePerUnit / ingredientInMl;
                return costPerMl * recipeInMl;
            } else {
                // Para ingredientes sólidos, convertir todo a gramos
                ingredientInGrams = solidConversions[ingredientUnit] || 1;
                
                // Si la receta usa medidas de volumen (tazas, cucharadas), convertir a peso
                if (['taza', '1/2-taza', '1/3-taza', '1/4-taza', 'cda', 'cdta', 'pizca'].includes(recipeUnit)) {
                    // Usar conversiones específicas para ingredientes comunes
                    recipeInGrams = getIngredientSpecificConversion(ingredient.name, recipeUnit, recipeQuantity);
                } else {
                    // Para medidas de peso directas
                    recipeInGrams = (solidConversions[recipeUnit] || 1) * recipeQuantity;
                }
                
                const costPerGram = ingredientPricePerUnit / ingredientInGrams;
                return costPerGram * recipeInGrams;
            }
        }
        
        function getIngredientSpecificConversion(ingredientName, unit, quantity) {
            // Conversiones específicas por ingrediente (gramos por taza/cucharada)
            const specificConversions = {
                // Azúcares
                'azucar': { 'taza': 200, '1/2-taza': 100, '1/3-taza': 67, '1/4-taza': 50, 'cda': 12, 'cdta': 4, 'pizca': 0.5 },
                'azúcar': { 'taza': 200, '1/2-taza': 100, '1/3-taza': 67, '1/4-taza': 50, 'cda': 12, 'cdta': 4, 'pizca': 0.5 },
                'azucar blanca': { 'taza': 200, '1/2-taza': 100, '1/3-taza': 67, '1/4-taza': 50, 'cda': 12, 'cdta': 4, 'pizca': 0.5 },
                'azucar morena': { 'taza': 220, '1/2-taza': 110, '1/3-taza': 73, '1/4-taza': 55, 'cda': 14, 'cdta': 5, 'pizca': 0.5 },
                
                // Harinas
                'harina': { 'taza': 120, '1/2-taza': 60, '1/3-taza': 40, '1/4-taza': 30, 'cda': 8, 'cdta': 3, 'pizca': 0.3 },
                'harina de trigo': { 'taza': 120, '1/2-taza': 60, '1/3-taza': 40, '1/4-taza': 30, 'cda': 8, 'cdta': 3, 'pizca': 0.3 },
                
                // Mantequilla y grasas
                'mantequilla': { 'taza': 227, '1/2-taza': 113, '1/3-taza': 76, '1/4-taza': 57, 'cda': 14, 'cdta': 5, 'pizca': 0.5 },
                'manteca': { 'taza': 205, '1/2-taza': 102, '1/3-taza': 68, '1/4-taza': 51, 'cda': 13, 'cdta': 4, 'pizca': 0.5 },
                
                // Polvos
                'polvo de hornear': { 'taza': 192, '1/2-taza': 96, '1/3-taza': 64, '1/4-taza': 48, 'cda': 12, 'cdta': 4, 'pizca': 0.4 },
                'bicarbonato': { 'taza': 220, '1/2-taza': 110, '1/3-taza': 73, '1/4-taza': 55, 'cda': 14, 'cdta': 5, 'pizca': 0.5 },
                'sal': { 'taza': 300, '1/2-taza': 150, '1/3-taza': 100, '1/4-taza': 75, 'cda': 18, 'cdta': 6, 'pizca': 0.6 },
                
                // Cocoa y chocolate
                'cocoa': { 'taza': 85, '1/2-taza': 42, '1/3-taza': 28, '1/4-taza': 21, 'cda': 5, 'cdta': 2, 'pizca': 0.2 },
                'cacao': { 'taza': 85, '1/2-taza': 42, '1/3-taza': 28, '1/4-taza': 21, 'cda': 5, 'cdta': 2, 'pizca': 0.2 }
            };
            
            // Buscar el ingrediente por nombre (insensible a mayúsculas)
            const lowerName = ingredientName.toLowerCase();
            let conversion = specificConversions[lowerName];
            
            // Si no encuentra conversión específica, usar conversiones generales para sólidos
            if (!conversion) {
                conversion = { 'taza': 120, '1/2-taza': 60, '1/3-taza': 40, '1/4-taza': 30, 'cda': 8, 'cdta': 3, 'pizca': 0.3 };
            }
            
            return (conversion[unit] || solidConversions[unit] || 1) * quantity;
        }

        function clearProductForm() {
            document.getElementById('productName').value = '';
            document.getElementById('recipeIngredients').innerHTML = '';
        }

        function updateProductsDisplay() {
            const container = document.getElementById('productsList');
            container.innerHTML = '';

            products.forEach(product => {
                const div = document.createElement('div');
                div.className = 'bg-orange-50 rounded-xl p-4 border border-orange-200';
                
                const recipeDetails = product.recipe.map(item => 
                    `<div class="text-sm text-gray-600">• ${item.quantity} ${item.unit} de ${item.ingredient.name} - $${item.cost.toFixed(2)}</div>`
                ).join('');

                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-semibold text-gray-800 text-lg">${product.name}</h3>
                        <button onclick="removeProduct(${product.id})" class="text-red-500 hover:text-red-700 font-bold">×</button>
                    </div>
                    <div class="space-y-1 mb-3">
                        ${recipeDetails}
                    </div>
                    <div class="border-t border-orange-200 pt-2">
                        <div class="text-lg font-bold text-orange-600">
                            Costo Total: $${product.totalCost.toFixed(2)}
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function removeProduct(id) {
            products = products.filter(prod => prod.id !== id);
            updateProductsDisplay();
        }
    </script>
</body>
</html>